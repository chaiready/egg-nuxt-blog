(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{469:function(t,e,n){"use strict";n.r(e);n(213),n(46),n(59);var r=n(12),o=function(){return r.a.get("/messages")},c=function(t,e){return r.a.post("/messages/".concat(t,"/reply"),e)},d=function(t){return r.a.post("/messages",t)},l=function(t){return r.a.post("/messages/".concat(t,"/digg"))},f={layout:"public",name:"message",data:function(){return{dataList:[]}},computed:{options:function(){return this.$store.state.configuration.siteConfig.message},renderData:function(){var t=JSON.parse(JSON.stringify(this.dataList));return function e(n){return n.forEach((function(n){n.children=t.filter((function(sub){return sub.parentID===n.id})),e(n.children||[])})),n}(t.filter((function(t){return!t.parentID})))}},created:function(){var t=this;o().then((function(e){t.dataList=e}))},methods:{invalid:function(t){this.type=t,this.collapseEditor()},collapseEditor:function(){"comment"===this.type?this.$refs.editor.hide():this.$refs.commentEditor.clearValidate()},reply:function(t){this.$refs.editor.show(),this.replyParentID=t.id,this.$refs.editor.clearValidate(),this.$refs.editor.focus("content")},thumbup:function(t){var e=this;this.$store.state.message.diggedIdList.includes(t)||this.thumbupLoading||(this.thumbupLoading=!0,l(t).then((function(){e.$store.commit("message/pushDiggId",t),e.dataList.find((function(e){return e.id===t})).thumbupCount++,e.thumbupLoading=!1})))},submit:function(t,e){var n=this;this.type=t;var r="comment"===t?d(e):c(this.replyParentID,e);this.collapseEditor(),r.then((function(t){n.dataList.unshift(t)})).catch((function(t){n.$message.error(t.message)}))}}},m=n(4),component=Object(m.a)(f,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"message"},[n("el-divider",{attrs:{"content-position":"left"}},[n("i",{staticClass:"el-icon-edit-outline"}),t._v(" 留言板\n  ")]),t._v(" "),n("message-editor",{ref:"commentEditor",on:{"on-focus":function(e){return t.$refs.editor.hide()},"on-submit":function(e){return t.submit("comment",e)},"on-invalid":function(e){return t.invalid("comment",e)}}}),t._v(" "),n("el-divider",{attrs:{"content-position":"left"}},[n("i",{staticClass:"el-icon-s-comment"}),t._v(" \n    留言墙")]),t._v(" "),n("client-only",[n("message-tree",{attrs:{"data-list":t.renderData,"render-layer":t.options.renderLayer,"default-expand-layer":t.options.expandLayer},on:{"on-thumbup":function(e){return t.thumbup(e.id)},"on-reply":t.reply}},[n("message-editor",{ref:"editor",attrs:{slot:"editor",type:"reply"},on:{"on-focus":function(e){return t.$refs.commentEditor.clearValidate()},"on-submit":function(e){return t.submit("reply",e)},"on-invalid":function(e){return t.invalid("reply",e)}},slot:"editor"})],1)],1)],1)}),[],!1,null,null,null);e.default=component.exports}}]);